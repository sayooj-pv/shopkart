{% extends "store/base.html" %}

{% block content %}
<h1>Your Favorites</h1>

{% if favorites %}
<div class="product-grid">
    {% for fav in favorites %}
    <div class="product-card">

        <!-- Heart Button (remove from favorites) -->
        <div class="fav-btn" onclick="toggleFavorite('{{ fav.product.id }}')">
            <i id="fav-{{ fav.product.id }}" class="fa-solid fa-heart fav-icon"></i>
        </div>

        <img src="{{ fav.product.image.url }}" class="product-img">

        <div class="product-info">
            <h3 class="product-name">
                <a href="{{ fav.product.get_absolute_url }}">{{ fav.product.name }}</a>
            </h3>

            <!-- Price box with strike for original price -->
            <div class="price-box">
                {% if fav.product.offer_price %}
                    <span class="offer-price">₹{{ fav.product.offer_price }}</span>
                    <span class="old-price">₹{{ fav.product.price }}</span>
                {% else %}
                    <span class="offer-price">₹{{ fav.product.price }}</span>
                {% endif %}
            </div>
        </div>

    </div>
    {% endfor %}
</div>

{% else %}
<p>You have no favorite items.</p>
{% endif %}

<script>
function toggleFavorite(id) {
    let heart = document.getElementById("fav-" + id);

    fetch(`/favorite/${id}/`)
        .then(res => res.json())
        .then(data => {
            if (data.status === "removed") {
                // Remove product card instantly
                heart.closest(".product-card").remove();
            }
        });
}
</script>

<style>
.fav-icon {
    color: red;
    font-size: 22px;
    cursor: pointer;
}
</style>

{% endblock %}
